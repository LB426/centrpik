<% provide(:title, "Тесты") %>
<div class="row">
  <div class="col-md-1"><h4>Тесты</h4></div>
  <% if current_user.admin? %>
  <div class="col-md-2 col-md-offset-9">
	<%= link_to "Создать тест", tests_new_path, :class => "btn btn-primary btn-block" %>
  </div>
  <% end %>
</div>
<table class="table">
  <thead>
	<tr>
	  <th>#</th>
	  <th>Название теста</th>
	  <th>попыток</th>
	  <th>&nbsp;</th>
	  <th>&nbsp;</th>
	  <% if current_user.admin? %>
		<th>&nbsp;</th>
		<th>&nbsp;</th>
	  <% end %>
	</tr>
  </thead>
  <tbody>
	<% @tests.each do |test| %>
	  <% last_attempt = current_user.testing_stat_attempts.where(test_id: test).count %>
	  <tr>
		<th scope="row"><%= test.id %></th>
		<td><%= test.name %></td>
		<td>
		  <%= last_attempt %>
		</td>
		<% first_question = test.test_questions.all.order(:id => "asc")[0] %>
		<td>
		  <%= link_to "пройти тест", testing_new_path(test, first_question),
	      :class=>"btn btn-primary btn-xs" %>
		</td>
		<td>
		  <% if last_attempt != 0 %>
			<%= link_to "смотреть результат",
	        testing_result_show_path(test, last_attempt),
	        :class => "btn btn-success btn-xs" %>
		  <% else %>
			<button type="button" class="btn btn-success btn-xs"
			    disabled="disabled">смотреть результат
			</button>
		  <% end %>
		</td>
		<% if current_user.admin? %>
		  <td>
			<%= link_to "Редактировать", test_edit_path(test.id),
		    :class => "btn btn-danger btn-xs" %>
		  </td>
		  <td>
			<%= link_to "Удалить", test_destroy_path(test),
		    :method => :delete,
			:data => { confirm: "Вы уверены?" },
			:class => "btn btn-danger btn-xs" %>
		  </td>
		<% end %>
	  </tr>
	<% end %>
  </tbody>
</table>
